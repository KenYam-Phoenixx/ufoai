/**
 * @brief Unittest for actions
 * Move it into the ui ufo script directory (/base/ufos/ui/), run the game, and run the command "ui_push test_cvar"
 * Every thing must be green and it must not print any text or warning into the console.
 */

window test_angelscript
{
	{
		pos "100 100"
		size "340 400"
		dragbutton	true
		closebutton	true
		string		"_Unittest cvar"
		bgcolor		"0 0 0 1"
	}

	string test1 {
		pos		"200 60"
		string	"t1"
	}

	string test2 {
		pos		"200 70"
		string	"t2"
	}

	string test3 {
		pos		"200 80"
		string	"t3"
	}

	button buttonTest
	{
		{
			pos			"10 10"
			size		"50 50"
			color		".2187 .73 .23 1"
		}

		script {
			void onRClick() {
				node@ n = getNode("test_angelscript.buttonTest");
				n.color.red = 0.5;
				n.left = 23;
				n.ghost = false;

				color red;
				red.red = 1;
				red.green = 0;
				red.blue = 0;
				red.alpha = 1;
				n.bgcolor = red;

				color blue = "0 1 0";

				n.bordercolor = blue;
			}


			void onClick() {
				cvar@ b = getCvar("test_1");
				int a = 0;
				a++;
				b.integer = a;
				if (b.integer == 1) {
					cvar@ c = getCvar("test_2");
					c.integer = 2;
				}
				if (b.integer == 10) {
					// ...
				} else {
					cvar@ c = getCvar("test_3");
					c.string = "foobar";
				}
			}
		}
	}

	func testNode {
		call *node:root.buttonTest@onRClick
		cmd "echo <node:root.buttonTest@color> == 0.5 _ _ _"
		cmd "echo <node:root.buttonTest@bgcolor> == red"
		cmd "echo <node:root.buttonTest@bordercolor> == 0 1 0"
	}

	func testCvar {
		*cvar:test_1 = "aaaa"
		call *node:root.buttonTest@onClick

		if ( *cvar:test_1 == 1 ) { *node:root.test1@color = "0 1 0 1" }
		else { *node:root.test1@color = "1 0 0 1" }
		if ( *cvar:test_2 == 2 ) { *node:root.test2@color = "0 1 0 1" }
		else { *node:root.test2@color = "1 0 0 1" }
		if ( *cvar:test_3 eq "foobar" ) { *node:root.test3@color = "0 1 0 1" }
		else { *node:root.test3@color = "1 0 0 1" }

		delete *cvar:test_1
		delete *cvar:test_2
		delete *cvar:test_3
	}

	func onInit {
		call *node:root.testCvar
		call *node:root.testNode
	}

}
