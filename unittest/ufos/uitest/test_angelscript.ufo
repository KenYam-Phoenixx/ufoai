/**
 * @brief Unittest for actions
 * Move it into the ui ufo script directory (/base/ufos/ui/), run the game, and run the command "ui_push test_cvar"
 * Every thing must be green and it must not print any text or warning into the console.
 */

window test_angelscript
{
	{
		pos "100 100"
		size "340 400"
		dragbutton	true
		closebutton	true
		string		"_Unittest cvar"
		bgcolor		"0 0 0 1"
	}

	string test1 {
		pos		"200 60"
		string	"t1"
	}

	string test2 {
		pos		"200 70"
		string	"t2"
	}

	string test3 {
		pos		"200 80"
		string	"t3"
	}

	string test4 {
		pos		"200 80"
		string	"t3"
	}

	string test5 {
		pos		"200 80"
		string	"t3"
	}

	string test6 {
		pos		"200 80"
		string	"t3"
	}

	string test7 {
		pos		"200 80"
		string	"t3"
	}

	string test8 {
		pos		"200 80"
		string	"t3"
	}

	string test9 {
		pos		"200 80"
		string	"t3"
	}

	button buttonTest
	{
		{
			pos			"10 10"
			size		"50 50"
			color		".2187 .73 .23 1"
		}

		script {

			void onClick() {
				cvar@ b = getCvar("test_1");
				int a = 0;
				a++;
				b.integer = a;
				if (b.integer == 1) {
					cvar@ c = getCvar("test_2");
					c.integer = 2;
				}
				if (b.integer == 10) {
					// ...
				} else {
					cvar@ c = getCvar("test_3");
					c.string = "foobar";
				}
			}

			void onRClick() {
				node@ n = getNode("test_angelscript.buttonTest");
				n.color.red = 0.5;
				n.left = 23;
				n.ghost = false;

				color red;
				red.red = 1;
				red.green = 0;
				red.blue = 0;
				red.alpha = 1;
				n.bgcolor = red;

				color blue = "0 1 0";

				n.bordercolor = blue;
			}

			void onMClick() {
				color red = "1 0 0";
				color green = "0 1 0";
				node@ n = getNode("test_angelscript.buttonTest");

				node@ test_1 = getNode("test_angelscript.test4");
				node@ test_2 = getNode("test_angelscript.test5");
				bool b = (test_1 == test_2);

//				this copy CRASH
//				node@ test;
//				test = getNode("test_angelscript.test4");

				node@ test4 = getNode("test_angelscript.test4");
				node@ window = n.window;
				if (window.type == "window") test4.color = green;
				else test4.color = red;

				node@ test5 = getNode("test_angelscript.test5");
				if (window.name == "test_angelscript") test5.color = green;
				else test5.color = red;

				node@ test6 = getNode("test_angelscript.test6");
				node@ nothing = window.parent;
				if (nothing == null) test6.color = green;
				else test6.color = red;

				node@ test7 = getNode("test_angelscript.test7");
				node@ child = n.firstChild;
				if (child == null) test7.color = green;
				else test7.color = red;

				node@ test8 = getNode("test_angelscript.test8");
				node@ parent = n.parent;
				if (parent == window) test8.color = green;
				else test8.color = red;

				node@ test9 = getNode("test_angelscript.test9");
				node@ next = n.next;
				if (next != null) test9.color = green;
				else test9.color = red;
			}
		}
	}

	func testNodeNavigation {
		call *node:root.buttonTest@onMClick
	}

	func testNodeProperties {
		call *node:root.buttonTest@onRClick
		cmd "echo <node:root.buttonTest@color> == 0.5 _ _ _"
		cmd "echo <node:root.buttonTest@bgcolor> == red"
		cmd "echo <node:root.buttonTest@bordercolor> == 0 1 0"
	}

	func testCvar {
		*cvar:test_1 = "aaaa"
		call *node:root.buttonTest@onClick

		if ( *cvar:test_1 == 1 ) { *node:root.test1@color = "0 1 0 1" }
		else { *node:root.test1@color = "1 0 0 1" }
		if ( *cvar:test_2 == 2 ) { *node:root.test2@color = "0 1 0 1" }
		else { *node:root.test2@color = "1 0 0 1" }
		if ( *cvar:test_3 eq "foobar" ) { *node:root.test3@color = "0 1 0 1" }
		else { *node:root.test3@color = "1 0 0 1" }

		delete *cvar:test_1
		delete *cvar:test_2
		delete *cvar:test_3
	}

	func onInit {
		call *node:root.testCvar
		call *node:root.testNodeProperties
		call *node:root.testNodeNavigation
	}

}
