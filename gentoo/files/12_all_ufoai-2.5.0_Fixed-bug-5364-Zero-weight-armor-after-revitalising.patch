From fde3e36aaaf96c91d6bfde964c63b9292d143c61 Mon Sep 17 00:00:00 2001
From: DarkRain <darkrainx@users.sourceforge.net>
Date: Wed, 6 Aug 2014 18:51:30 -0500
Subject: [PATCH 12/40] * Fixed bug #5364 (Zero-weight armor after
 revitalising)

Conflicts:
	src/game/g_inventory.cpp
---
 src/client/battlescape/cl_actor.cpp | 4 ----
 src/game/g_inventory.cpp            | 1 +
 2 files changed, 1 insertion(+), 4 deletions(-)

diff --git a/src/client/battlescape/cl_actor.cpp b/src/client/battlescape/cl_actor.cpp
index 5194b91bbc..a97cce4d30 100644
--- a/src/client/battlescape/cl_actor.cpp
+++ b/src/client/battlescape/cl_actor.cpp
@@ -420,10 +420,6 @@ void CL_ActorRemoveFromTeamList (le_t* le)
 				CL_ActorCleanup(le);
 				/* remove from list */
 				cl.teamList[i] = nullptr;
-			} else {
-				/** @todo why the heck is that needed? the inventory was already dropped to floor. */
-				le->left = le->right = le->headgear = NONE;
-				cls.i.destroyInventory(&le->inv);
 			}
 
 			/* disable hud button */
diff --git a/src/game/g_inventory.cpp b/src/game/g_inventory.cpp
index e5ba637d58..0ea7a8e5d3 100644
--- a/src/game/g_inventory.cpp
+++ b/src/game/g_inventory.cpp
@@ -272,6 +272,7 @@ void G_InventoryToFloor (Edict* ent)
 			if (!game.i.removeFromInventory(&ent->chr.inv, INVDEF(container), ic))
 				gi.Error("Could not remove item '%s' from inventory %i of entity %i",
 						ic->def()->id, container, ent->number);
+			G_EventInventoryDelete(*ent, G_VisToPM(ent->visflags), container, ic->getX(), ic->getY());
 			if (game.i.addToInventory(&floor->chr.inv, &item, INVDEF(CID_FLOOR), NONE, NONE, 1) == nullptr)
 				gi.Error("Could not add item '%s' from inventory %i of entity %i to floor container",
 						ic->def()->id, container, ent->number);
-- 
2.16.1

